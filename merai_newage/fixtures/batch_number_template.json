[
 {
  "batch_number_logic": "doc = variables[\"doc\"]\n\n# Get production item from Work Order\nproduction_item = doc.production_item\nitem_doc = frappe.get_doc(\"Item\", production_item)\n\nmaterial_type = item_doc.custom_material_type\nitem_code_field = item_doc.custom_code\n\n# Date parts - using planned_start_date from Work Order\nif doc.planned_start_date:\n    wo_date = str(doc.planned_start_date)  # Convert date to string (YYYY-MM-DD)\nelse:\n    # Fallback to today if planned_start_date is not set\n    wo_date = frappe.utils.today()\n\nyear_code = wo_date[2:4]  # Last two digits of year\nmonth_letters = \"ABCDEFGHIJKL\"\nmonth_code = month_letters[int(wo_date[5:7]) - 1]\n\n# Prefix logic\nif material_type.upper() == \"FG\":\n    static_prefix = \"RT\"\nelif material_type.upper() == \"SFG\":\n    static_prefix = \"IRT\"\nelse:\n    frappe.throw(f\"Unsupported Material Type: {material_type}\")\n\nfinal_prefix = f\"{static_prefix}{year_code}{month_code}{item_code_field.upper()}\"\n\n# Find last document for incremental number\nlast_doc = frappe.get_all(\n    \"Batch\",\n    filters=[[\"Batch\", \"name\", \"like\", f\"{final_prefix}%\"]],\n    order_by=\"creation desc\",\n    limit=1\n)\n\nif last_doc:\n    last_name = last_doc[0].name\n    last_number = int(last_name.replace(final_prefix, \"\"))\nelse:\n    last_number = 0\n\nnew_number = last_number + 1\nreturn final_prefix + str(new_number).zfill(3)\n",
  "batch_number_template_name": "MerAi Batch Number",
  "docstatus": 0,
  "doctype": "Batch Number Template",
  "modified": "2025-10-28 11:16:03.761537",
  "name": "MerAi Batch Number"
 },
 {
  "batch_number_logic": "doc = variables[\"doc\"]\n\nproduction_item = doc.production_item\nitem_doc = frappe.get_doc(\"Item\", production_item)\n\nitem_code_field = item_doc.get(\"custom_code\")\nif not item_code_field:\n    frappe.throw(\"Item missing custom_code required for batch number\")\n\n# Date parts - using planned_start_date from Work Order\nif doc.planned_start_date:\n    wo_date = str(doc.planned_start_date)  # Convert date to string (YYYY-MM-DD)\nelse:\n    # Fallback to today if planned_start_date is not set\n    wo_date = frappe.utils.today()\n\nyear_code = wo_date[2:4]  # Last two digits of year\nmonth_letters = \"ABCDEFGHIJKL\"\nmonth_code = month_letters[int(wo_date[5:7]) - 1]\n\nstatic_prefix = \"RT\"\n\nfinal_prefix = f\"{production_item}-{static_prefix}{year_code}{month_code}{item_code_field.upper()}\"\n\nlast_doc = frappe.get_all(\n    \"Batch\",\n    filters=[[\"Batch\", \"name\", \"like\", f\"{final_prefix}%\"]],\n    order_by=\"creation desc\",\n    limit=1\n)\n\nif last_doc:\n    last_name = last_doc[0].name\n    try:\n        last_number = int(last_name.replace(final_prefix, \"\"))\n    except:\n        last_number = 0\nelse:\n    last_number = 0\n\nnew_number = last_number + 1\n\nreturn final_prefix + str(new_number).zfill(3)\n",
  "batch_number_template_name": "MerAi Batch Number FG",
  "docstatus": 0,
  "doctype": "Batch Number Template",
  "modified": "2025-10-28 11:16:25.356042",
  "name": "MerAi Batch Number FG"
 },
 {
  "batch_number_logic": "doc = variables[\"doc\"]\n\n# Get production item from Work Order\nproduction_item = doc.production_item\nitem_doc = frappe.get_doc(\"Item\", production_item)\n\nmaterial_type = item_doc.custom_material_type\nitem_code_field = item_doc.custom_code\n\n# Date parts - using planned_start_date from Work Order\nif doc.planned_start_date:\n    wo_date = str(doc.planned_start_date)  # Convert date to string (YYYY-MM-DD)\nelse:\n    # Fallback to today if planned_start_date is not set\n    wo_date = frappe.utils.today()\n\nyear_code = wo_date[2:4]  # Last two digits of year\nmonth_letters = \"ABCDEFGHIJKL\"\nmonth_code = month_letters[int(wo_date[5:7]) - 1]\n\nstatic_prefix = \"IRT\"\n\nfinal_prefix = f\"{production_item}-{static_prefix}{year_code}{month_code}{item_code_field.upper()}\"\n\n# Find last document for incremental number\nlast_doc = frappe.get_all(\n    \"Batch\",\n    filters=[[\"Batch\", \"name\", \"like\", f\"{final_prefix}%\"]],\n    order_by=\"creation desc\",\n    limit=1\n)\n\nif last_doc:\n    last_name = last_doc[0].name\n    last_number = int(last_name.replace(final_prefix, \"\"))\nelse:\n    last_number = 0\n\nnew_number = last_number + 1\nreturn final_prefix + str(new_number).zfill(3)\n",
  "batch_number_template_name": "MerAi Batch Number SFG",
  "docstatus": 0,
  "doctype": "Batch Number Template",
  "modified": "2025-10-28 11:16:13.493966",
  "name": "MerAi Batch Number SFG"
 }
]
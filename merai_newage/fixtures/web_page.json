[
 {
  "breadcrumbs": null,
  "content_type": "HTML",
  "context_script": null,
  "css": null,
  "docstatus": 0,
  "doctype": "Web Page",
  "dynamic_route": 0,
  "dynamic_template": 0,
  "enable_comments": 0,
  "end_date": null,
  "full_width": 1,
  "header": null,
  "insert_style": 0,
  "javascript": null,
  "main_section": null,
  "main_section_html": "<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>Ticket Master Dashboard</title>\r\n    <style>\r\n        * {\r\n            margin: 0;\r\n            padding: 0;\r\n            box-sizing: border-box;\r\n        }\r\n\r\n        body {\r\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\r\n            background-color: #f5f7fa;\r\n            color: #36414c;\r\n            padding: 20px;\r\n        }\r\n\r\n        /* Hide Frappe header and footer */\r\n        .navbar, \r\n        .navbar-default,\r\n        header,\r\n        footer,\r\n        .page-head,\r\n        .page-actions,\r\n        .page-breadcrumb,\r\n        .layout-side-section,\r\n        .page-form,\r\n        .page-wrapper > .page-head,\r\n        .layout-main-section-wrapper > .page-head {\r\n            display: none !important;\r\n        }\r\n\r\n        .dashboard-header {\r\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\r\n            color: white;\r\n            padding: 15px 25px;\r\n            border-radius: 8px;\r\n            margin-bottom: 20px;\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n        }\r\n\r\n        .dashboard-header h1 {\r\n            font-size: 24px;\r\n            font-weight: 600;\r\n            margin-bottom: 5px;\r\n        }\r\n\r\n        .dashboard-header p {\r\n            font-size: 13px;\r\n            opacity: 0.9;\r\n        }\r\n\r\n        /* Year Overview Section */\r\n        .year-overview-section {\r\n            background: white;\r\n            padding: 25px;\r\n            border-radius: 12px;\r\n            margin-bottom: 20px;\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n        }\r\n\r\n        .year-overview-section h3 {\r\n            font-size: 18px;\r\n            font-weight: 600;\r\n            margin-bottom: 20px;\r\n            color: #36414c;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 8px;\r\n        }\r\n\r\n        .overview-chart-container {\r\n            min-height: 350px;\r\n            position: relative;\r\n        }\r\n\r\n        .filters-section {\r\n            background: white;\r\n            padding: 15px 20px;\r\n            border-radius: 8px;\r\n            margin-bottom: 20px;\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n            transition: all 0.3s ease;\r\n        }\r\n\r\n        .filters-section.collapsed {\r\n            padding: 10px 20px;\r\n        }\r\n\r\n        .filters-section.collapsed .filter-content {\r\n            display: none;\r\n        }\r\n\r\n        .filter-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            cursor: pointer;\r\n            user-select: none;\r\n        }\r\n\r\n        .filter-header h3 {\r\n            font-size: 15px;\r\n            font-weight: 600;\r\n            margin: 0;\r\n            color: #36414c;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 8px;\r\n        }\r\n\r\n        .collapse-icon {\r\n            font-size: 18px;\r\n            transition: transform 0.3s ease;\r\n        }\r\n\r\n        .filters-section.collapsed .collapse-icon {\r\n            transform: rotate(-90deg);\r\n        }\r\n\r\n        .filter-content {\r\n            margin-top: 15px;\r\n        }\r\n\r\n        .filter-group {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\r\n            gap: 15px;\r\n            margin-bottom: 15px;\r\n        }\r\n\r\n        .filter-item {\r\n            display: flex;\r\n            flex-direction: column;\r\n        }\r\n\r\n        .filter-item label {\r\n            font-size: 13px;\r\n            font-weight: 500;\r\n            color: #6c757d;\r\n            margin-bottom: 5px;\r\n        }\r\n\r\n        .filter-item select,\r\n        .filter-item input {\r\n            padding: 8px 12px;\r\n            border: 1px solid #d1d8dd;\r\n            border-radius: 6px;\r\n            font-size: 14px;\r\n            background: white;\r\n            transition: border-color 0.2s;\r\n        }\r\n\r\n        .filter-item select:focus,\r\n        .filter-item input:focus {\r\n            outline: none;\r\n            border-color: #667eea;\r\n        }\r\n\r\n        .filter-actions {\r\n            display: flex;\r\n            gap: 10px;\r\n            margin-top: 15px;\r\n        }\r\n\r\n        .btn {\r\n            padding: 10px 20px;\r\n            border: none;\r\n            border-radius: 6px;\r\n            font-size: 14px;\r\n            font-weight: 500;\r\n            cursor: pointer;\r\n            transition: all 0.2s;\r\n        }\r\n\r\n        .btn-primary {\r\n            background: #667eea;\r\n            color: white;\r\n        }\r\n\r\n        .btn-primary:hover {\r\n            background: #5568d3;\r\n        }\r\n\r\n        .btn-secondary {\r\n            background: #f8f9fa;\r\n            color: #36414c;\r\n            border: 1px solid #d1d8dd;\r\n        }\r\n\r\n        .btn-secondary:hover {\r\n            background: #e9ecef;\r\n        }\r\n\r\n        .loading {\r\n            text-align: center;\r\n            padding: 20px;\r\n            font-size: 16px;\r\n            color: #6c757d;\r\n        }\r\n\r\n        .metrics-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\r\n            gap: 20px;\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .metric-card {\r\n            background: white;\r\n            padding: 25px;\r\n            border-radius: 12px;\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n            border-left: 4px solid #667eea;\r\n            transition: transform 0.2s, box-shadow 0.2s;\r\n            cursor: pointer;\r\n        }\r\n\r\n        .metric-card:hover {\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\r\n        }\r\n\r\n        .metric-card.resolved { border-left-color: #28a745; }\r\n        .metric-card.pending { border-left-color: #ffc107; }\r\n        .metric-card.issue { border-left-color: #dc3545; }\r\n        .metric-card.total { border-left-color: #667eea; }\r\n\r\n        .metric-label {\r\n            font-size: 14px;\r\n            font-weight: 500;\r\n            color: #6c757d;\r\n            margin-bottom: 10px;\r\n            text-transform: uppercase;\r\n            letter-spacing: 0.5px;\r\n        }\r\n\r\n        .metric-value {\r\n            font-size: 36px;\r\n            font-weight: 700;\r\n            color: #36414c;\r\n            margin-bottom: 8px;\r\n        }\r\n\r\n        .metric-change {\r\n            font-size: 13px;\r\n            color: #28a745;\r\n            font-weight: 500;\r\n        }\r\n\r\n        .charts-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\r\n            gap: 25px;\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .chart-card {\r\n            background: white;\r\n            padding: 25px;\r\n            border-radius: 12px;\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n        }\r\n\r\n        .chart-card h3 {\r\n            font-size: 18px;\r\n            font-weight: 600;\r\n            margin-bottom: 20px;\r\n            color: #36414c;\r\n        }\r\n\r\n        .chart-container {\r\n            min-height: 300px;\r\n            position: relative;\r\n        }\r\n\r\n        .chart-with-scroll {\r\n            max-height: 400px;\r\n            overflow-y: auto;\r\n            overflow-x: hidden;\r\n        }\r\n\r\n        .pagination-controls {\r\n            display: flex;\r\n            justify-content: center;\r\n            align-items: center;\r\n            gap: 10px;\r\n            margin-top: 15px;\r\n            padding-top: 15px;\r\n            border-top: 1px solid #e9ecef;\r\n        }\r\n\r\n        .pagination-btn {\r\n            padding: 8px 16px;\r\n            border: 1px solid #d1d8dd;\r\n            border-radius: 6px;\r\n            background: white;\r\n            color: #36414c;\r\n            cursor: pointer;\r\n            font-size: 13px;\r\n            font-weight: 500;\r\n            transition: all 0.2s;\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 5px;\r\n        }\r\n\r\n        .pagination-btn:hover:not(:disabled) {\r\n            background: #667eea;\r\n            color: white;\r\n            border-color: #667eea;\r\n        }\r\n\r\n        .pagination-btn:disabled {\r\n            opacity: 0.4;\r\n            cursor: not-allowed;\r\n            background: #f8f9fa;\r\n        }\r\n\r\n        .pagination-info {\r\n            font-size: 13px;\r\n            color: #6c757d;\r\n            font-weight: 500;\r\n            padding: 0 10px;\r\n            min-width: 120px;\r\n            text-align: center;\r\n        }\r\n\r\n        .pagination-jump {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 5px;\r\n        }\r\n\r\n        .pagination-jump input {\r\n            width: 50px;\r\n            padding: 6px 8px;\r\n            border: 1px solid #d1d8dd;\r\n            border-radius: 4px;\r\n            font-size: 13px;\r\n            text-align: center;\r\n        }\r\n\r\n        .pagination-jump button {\r\n            padding: 6px 12px;\r\n            border: 1px solid #d1d8dd;\r\n            border-radius: 4px;\r\n            background: white;\r\n            color: #36414c;\r\n            cursor: pointer;\r\n            font-size: 12px;\r\n            transition: all 0.2s;\r\n        }\r\n\r\n        .pagination-jump button:hover {\r\n            background: #667eea;\r\n            color: white;\r\n            border-color: #667eea;\r\n        }\r\n\r\n        .table-section {\r\n            background: white;\r\n            padding: 25px;\r\n            border-radius: 12px;\r\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\r\n            overflow-x: auto;\r\n        }\r\n\r\n        .table-section h3 {\r\n            font-size: 18px;\r\n            font-weight: 600;\r\n            margin-bottom: 20px;\r\n            color: #36414c;\r\n        }\r\n\r\n        table {\r\n            width: 100%;\r\n            border-collapse: collapse;\r\n            min-width: 1100px;\r\n        }\r\n\r\n        thead {\r\n            background-color: #f8f9fa;\r\n        }\r\n\r\n        th {\r\n            padding: 12px;\r\n            text-align: left;\r\n            font-size: 13px;\r\n            font-weight: 600;\r\n            color: #6c757d;\r\n            text-transform: uppercase;\r\n            letter-spacing: 0.5px;\r\n            border-bottom: 2px solid #e9ecef;\r\n        }\r\n\r\n        td {\r\n            padding: 12px;\r\n            font-size: 14px;\r\n            border-bottom: 1px solid #e9ecef;\r\n        }\r\n\r\n        tbody tr:hover {\r\n            background-color: #f8f9fa;\r\n        }\r\n\r\n        .status-badge {\r\n            display: inline-block;\r\n            padding: 4px 12px;\r\n            border-radius: 20px;\r\n            font-size: 12px;\r\n            font-weight: 500;\r\n        }\r\n\r\n        .status-resolved {\r\n            background-color: #d4edda;\r\n            color: #155724;\r\n        }\r\n\r\n        .status-pending {\r\n            background-color: #fff3cd;\r\n            color: #856404;\r\n        }\r\n\r\n        .status-open {\r\n            background-color: #cce5ff;\r\n            color: #004085;\r\n        }\r\n\r\n        .status-closed {\r\n            background-color: #d6d8db;\r\n            color: #383d41;\r\n        }\r\n\r\n        .ticket-link {\r\n            color: #667eea;\r\n            text-decoration: none;\r\n            font-weight: 500;\r\n        }\r\n\r\n        .ticket-link:hover {\r\n            text-decoration: underline;\r\n        }\r\n\r\n        .refresh-info {\r\n            font-size: 12px;\r\n            color: #6c757d;\r\n            margin-top: 10px;\r\n            text-align: right;\r\n        }\r\n\r\n        .error-message {\r\n            background-color: #f8d7da;\r\n            color: #721c24;\r\n            padding: 15px;\r\n            border-radius: 6px;\r\n            margin-bottom: 20px;\r\n            border: 1px solid #f5c6cb;\r\n        }\r\n\r\n        /* Custom scrollbar */\r\n        .chart-with-scroll::-webkit-scrollbar {\r\n            width: 8px;\r\n        }\r\n\r\n        .chart-with-scroll::-webkit-scrollbar-track {\r\n            background: #f1f1f1;\r\n            border-radius: 4px;\r\n        }\r\n\r\n        .chart-with-scroll::-webkit-scrollbar-thumb {\r\n            background: #888;\r\n            border-radius: 4px;\r\n        }\r\n\r\n        .chart-with-scroll::-webkit-scrollbar-thumb:hover {\r\n            background: #555;\r\n        }\r\n\r\n        @media (max-width: 768px) {\r\n            .metrics-grid,\r\n            .charts-grid {\r\n                grid-template-columns: 1fr;\r\n            }\r\n\r\n            .filter-group {\r\n                grid-template-columns: 1fr;\r\n            }\r\n\r\n            .charts-grid {\r\n                grid-template-columns: 1fr;\r\n            }\r\n\r\n            .pagination-controls {\r\n                flex-wrap: wrap;\r\n            }\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"dashboard-header\">\r\n        <h1>üé´ Ticket Master Dashboard</h1>\r\n        <p>Real-time ticket management and analytics</p>\r\n    </div>\r\n\r\n    <div id=\"errorContainer\"></div>\r\n\r\n    <!-- Year-wise Overview Chart - Always Visible -->\r\n    <div class=\"year-overview-section\">\r\n        <h3>üìä Ticket Status Overview by Year</h3>\r\n        <div id=\"yearOverviewLoading\" class=\"loading\" style=\"display: none;\">\r\n            Loading overview data...\r\n        </div>\r\n        <div class=\"overview-chart-container\">\r\n            <canvas id=\"yearOverviewChart\"></canvas>\r\n        </div>\r\n    </div>\r\n\r\n    <div id=\"initialMessage\" class=\"filters-section\" style=\"text-align: center; padding: 20px;\">\r\n        <h3 style=\"margin-bottom: 8px; font-size: 15px;\">üìÖ Select Date Range to View Detailed Dashboard</h3>\r\n        <p style=\"color: #6c757d; font-size: 13px;\">Please select From Date and To Date, then click \"Apply Filters\" to load detailed dashboard data.</p>\r\n    </div>\r\n\r\n    <div class=\"filters-section\" id=\"filterSection\">\r\n        <div class=\"filter-header\" onclick=\"toggleFilters()\">\r\n            <h3>\r\n                <span>üìä Filters</span>\r\n            </h3>\r\n            <span class=\"collapse-icon\">‚ñº</span>\r\n        </div>\r\n        <div class=\"filter-content\">\r\n            <div class=\"filter-group\">\r\n                <div class=\"filter-item\">\r\n                    <label>From Date *</label>\r\n                    <input type=\"date\" id=\"fromDate\">\r\n                </div>\r\n                <div class=\"filter-item\">\r\n                    <label>To Date *</label>\r\n                    <input type=\"date\" id=\"toDate\">\r\n                </div>\r\n                <div class=\"filter-item\">\r\n                    <label>State</label>\r\n                    <select id=\"stateFilter\">\r\n                        <option value=\"\">Select State</option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"filter-item\">\r\n                    <label>Hospital Name</label>\r\n                    <select id=\"hospitalFilter\">\r\n                        <option value=\"\">Select Hospital</option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"filter-item\">\r\n                    <label>Robot Serial No</label>\r\n                    <select id=\"robotFilter\">\r\n                        <option value=\"\">Select Robot</option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"filter-item\">\r\n                    <label>Status</label>\r\n                    <select id=\"statusFilter\">\r\n                        <option value=\"\">Select Status</option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"filter-item\">\r\n                    <label>Priority</label>\r\n                    <select id=\"priorityFilter\">\r\n                        <option value=\"\">Select Priority</option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"filter-item\">\r\n                    <label>Issue Type</label>\r\n                    <select id=\"issueTypeFilter\">\r\n                        <option value=\"\">Select Type</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n            <div class=\"filter-actions\">\r\n                <button class=\"btn btn-primary\" onclick=\"applyFilters()\">Apply Filters</button>\r\n                <button class=\"btn btn-secondary\" onclick=\"clearFilters()\">Clear Filters</button>\r\n                <button class=\"btn btn-secondary\" onclick=\"refreshData()\">üîÑ Refresh</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div id=\"loadingIndicator\" class=\"loading\" style=\"display: none;\">\r\n        Loading dashboard data...\r\n    </div>\r\n\r\n    <div id=\"dashboardContent\" style=\"display: none;\">\r\n        <div class=\"metrics-grid\">\r\n            <div class=\"metric-card total\" onclick=\"navigateToDoctypeWithFilters({})\">\r\n                <div class=\"metric-label\">Total Tickets</div>\r\n                <div class=\"metric-value\" id=\"totalTickets\">0</div>\r\n                <div class=\"metric-change\" id=\"weekCount\">+0 this week</div>\r\n            </div>\r\n            <div class=\"metric-card resolved\" onclick=\"navigateToDoctypeWithFilters({workflow_state: 'Resolved'})\">\r\n                <div class=\"metric-label\">Resolved</div>\r\n                <div class=\"metric-value\" id=\"resolvedTickets\">0</div>\r\n                <div class=\"metric-change\" id=\"resolvedPercent\">0% of total</div>\r\n            </div>\r\n            <div class=\"metric-card pending\" onclick=\"navigateToDoctypeWithFilters({workflow_state_not: 'Resolved'})\">\r\n                <div class=\"metric-label\">Pending</div>\r\n                <div class=\"metric-value\" id=\"pendingTickets\">0</div>\r\n                <div class=\"metric-change\" id=\"pendingPercent\">0% of total</div>\r\n            </div>\r\n            <div class=\"metric-card\" style=\"border-left-color: #6c757d;\" onclick=\"navigateToDoctypeWithFilters({workflow_state: 'Cancelled'})\">\r\n                <div class=\"metric-label\">Cancelled</div>\r\n                <div class=\"metric-value\" id=\"cancelledTickets\">0</div>\r\n                <div class=\"metric-change\" id=\"cancelledPercent\">0% of total</div>\r\n            </div>\r\n            <div class=\"metric-card issue\">\r\n                <div class=\"metric-label\">Avg Resolution Time</div>\r\n                <div class=\"metric-value\" style=\"font-size: 28px;\" id=\"avgTime\">0 days</div>\r\n                <div class=\"metric-change\">Average time to resolve</div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"charts-grid\">\r\n            <div class=\"chart-card\">\r\n                <h3>üìà Ticket Status Distribution</h3>\r\n                <div class=\"chart-container\">\r\n                    <canvas id=\"statusChart\"></canvas>\r\n                </div>\r\n            </div>\r\n            <div class=\"chart-card\">\r\n                <h3>üìä Tickets by Issue Type</h3>\r\n                <div class=\"chart-container\">\r\n                    <canvas id=\"issueTypeChart\"></canvas>\r\n                </div>\r\n            </div>\r\n            <div class=\"chart-card\">\r\n                <h3>üìÖ Tickets Over Time</h3>\r\n                <div class=\"chart-container\" style=\"cursor: default;\">\r\n                    <canvas id=\"timelineChart\"></canvas>\r\n                </div>\r\n                <div class=\"pagination-controls\" id=\"timelinePagination\" style=\"display: none;\">\r\n                    <button class=\"pagination-btn\" onclick=\"changeTimelinePage(-1)\" id=\"timelinePrevBtn\">\r\n                        ‚Üê Previous\r\n                    </button>\r\n                    <span class=\"pagination-info\" id=\"timelinePageInfo\">Page 1 of 1</span>\r\n                    <div class=\"pagination-jump\">\r\n                        <span style=\"font-size: 12px; color: #6c757d;\">Go to:</span>\r\n                        <input type=\"number\" id=\"timelinePageInput\" min=\"1\" value=\"1\">\r\n                        <button onclick=\"jumpToTimelinePage()\">Go</button>\r\n                    </div>\r\n                    <button class=\"pagination-btn\" onclick=\"changeTimelinePage(1)\" id=\"timelineNextBtn\">\r\n                        Next ‚Üí\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <div class=\"chart-card\">\r\n                <h3>üè• Top Hospitals by Tickets</h3>\r\n                <div class=\"chart-with-scroll\" id=\"hospitalChartContainer\">\r\n                    <canvas id=\"hospitalChart\"></canvas>\r\n                </div>\r\n                <div class=\"pagination-controls\" id=\"hospitalPagination\" style=\"display: none;\">\r\n                    <button class=\"pagination-btn\" onclick=\"changeHospitalPage(-1)\" id=\"hospitalPrevBtn\">\r\n                        ‚Üê Previous\r\n                    </button>\r\n                    <span class=\"pagination-info\" id=\"hospitalPageInfo\">Page 1 of 1</span>\r\n                    <div class=\"pagination-jump\">\r\n                        <span style=\"font-size: 12px; color: #6c757d;\">Go to:</span>\r\n                        <input type=\"number\" id=\"hospitalPageInput\" min=\"1\" value=\"1\">\r\n                        <button onclick=\"jumpToHospitalPage()\">Go</button>\r\n                    </div>\r\n                    <button class=\"pagination-btn\" onclick=\"changeHospitalPage(1)\" id=\"hospitalNextBtn\">\r\n                        Next ‚Üí\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"charts-grid\">\r\n            <div class=\"chart-card\">\r\n                <h3>üìç Tickets by State</h3>\r\n                <div class=\"chart-with-scroll\" id=\"stateChartContainer\">\r\n                    <canvas id=\"stateChart\"></canvas>\r\n                </div>\r\n                <div class=\"pagination-controls\" id=\"statePagination\" style=\"display: none;\">\r\n                    <button class=\"pagination-btn\" onclick=\"changeStatePage(-1)\" id=\"statePrevBtn\">\r\n                        ‚Üê Previous\r\n                    </button>\r\n                    <span class=\"pagination-info\" id=\"statePageInfo\">Page 1 of 1</span>\r\n                    <div class=\"pagination-jump\">\r\n                        <span style=\"font-size: 12px; color: #6c757d;\">Go to:</span>\r\n                        <input type=\"number\" id=\"statePageInput\" min=\"1\" value=\"1\">\r\n                        <button onclick=\"jumpToStatePage()\">Go</button>\r\n                    </div>\r\n                    <button class=\"pagination-btn\" onclick=\"changeStatePage(1)\" id=\"stateNextBtn\">\r\n                        Next ‚Üí\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <div class=\"chart-card\">\r\n                <h3>‚ö†Ô∏è Priority Distribution</h3>\r\n                <div class=\"chart-container\">\r\n                    <canvas id=\"priorityChart\"></canvas>\r\n                </div>\r\n            </div>\r\n            <div class=\"chart-card\">\r\n                <h3>ü§ñ Robots with Most Issues</h3>\r\n                <div class=\"chart-with-scroll\" id=\"robotChartContainer\">\r\n                    <canvas id=\"robotChart\"></canvas>\r\n                </div>\r\n                <div class=\"pagination-controls\" id=\"robotPagination\" style=\"display: none;\">\r\n                    <button class=\"pagination-btn\" onclick=\"changeRobotPage(-1)\" id=\"robotPrevBtn\">\r\n                        ‚Üê Previous\r\n                    </button>\r\n                    <span class=\"pagination-info\" id=\"robotPageInfo\">Page 1 of 1</span>\r\n                    <div class=\"pagination-jump\">\r\n                        <span style=\"font-size: 12px; color: #6c757d;\">Go to:</span>\r\n                        <input type=\"number\" id=\"robotPageInput\" min=\"1\" value=\"1\">\r\n                        <button onclick=\"jumpToRobotPage()\">Go</button>\r\n                    </div>\r\n                    <button class=\"pagination-btn\" onclick=\"changeRobotPage(1)\" id=\"robotNextBtn\">\r\n                        Next ‚Üí\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"table-section\">\r\n            <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;\">\r\n                <h3>üìã Recent Tickets</h3>\r\n                <button class=\"btn btn-primary\" onclick=\"exportToCSV()\">Export to CSV</button>\r\n            </div>\r\n            <table>\r\n                <thead>\r\n                    <tr>\r\n                        <th>Ticket ID</th>\r\n                        <th>Status</th>\r\n                        <th>State</th>\r\n                        <th>Robot Serial No</th>\r\n                        <th>Ticket Subject</th>\r\n                        <th>Hospital</th>\r\n                        <th>Issue Type</th>\r\n                        <th>Priority</th>\r\n                        <th>Engineers</th>\r\n                        <th>Days Open</th>\r\n                        <th>Created On</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody id=\"ticketTable\">\r\n                    <!-- Data will be populated dynamically -->\r\n                </tbody>\r\n            </table>\r\n            <div class=\"refresh-info\">Last updated: <span id=\"lastUpdate\"></span></div>\r\n        </div>\r\n    </div>\r\n\r\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\r\n    <script>\r\n        // CRITICAL FIX: Hide Frappe UI elements on page load\r\n        document.addEventListener('DOMContentLoaded', function() {\r\n            console.log('Dashboard initialized');\r\n            \r\n            // Hide Frappe header and footer elements\r\n            setTimeout(function() {\r\n                const elementsToHide = document.querySelectorAll(\r\n                    '.navbar, .navbar-default, header, footer, .page-head, ' +\r\n                    '.page-actions, .page-breadcrumb, .layout-side-section, ' +\r\n                    '.page-form, .page-wrapper > .page-head, ' +\r\n                    '.layout-main-section-wrapper > .page-head, ' +\r\n                    '.page-title, .page-toolbar, .standard-actions, ' +\r\n                    '.page-icon, .page-wrapper-background'\r\n                );\r\n                \r\n                elementsToHide.forEach(el => {\r\n                    if (el) el.style.display = 'none';\r\n                });\r\n            }, 100);\r\n            \r\n            // Load year overview chart on page load\r\n            loadYearOverviewData();\r\n        });\r\n\r\n        // Toggle filter section collapse\r\n        function toggleFilters() {\r\n            const filterSection = document.getElementById('filterSection');\r\n            filterSection.classList.toggle('collapsed');\r\n        }\r\n\r\n        // Global variables\r\n        let dashboardData = null;\r\n        let charts = {};\r\n        let yearOverviewChart = null;\r\n        \r\n        // Pagination variables\r\n        const ITEMS_PER_PAGE = 10;\r\n        const SCROLL_THRESHOLD = 15;\r\n        \r\n        let currentPages = {\r\n            timeline: 0,\r\n            hospital: 0,\r\n            state: 0,\r\n            robot: 0\r\n        };\r\n        \r\n        let fullData = {\r\n            timeline: { labels: [], data: [] },\r\n            hospital: { labels: [], data: [] },\r\n            state: { labels: [], data: [] },\r\n            robot: { labels: [], data: [] }\r\n        };\r\n\r\n        // NEW FUNCTION: Load year-wise overview data\r\n        async function loadYearOverviewData() {\r\n            const loadingDiv = document.getElementById('yearOverviewLoading');\r\n            loadingDiv.style.display = 'block';\r\n            \r\n            try {\r\n                const response = await fetch('/api/method/merai_newage.merai_newage.utils.dashboard_api.get_year_overview', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'X-Frappe-CSRF-Token': frappe.csrf_token\r\n                    }\r\n                });\r\n                \r\n                if (!response.ok) {\r\n                    throw new Error(`HTTP error! status: ${response.status}`);\r\n                }\r\n                \r\n                const result = await response.json();\r\n                console.log('Year overview data received:', result);\r\n                \r\n                if (result.message) {\r\n                    renderYearOverviewChart(result.message);\r\n                } else {\r\n                    throw new Error('No overview data received from server');\r\n                }\r\n            } catch (error) {\r\n                console.error('Error loading year overview:', error);\r\n                showError('Failed to load year overview: ' + error.message);\r\n            } finally {\r\n                loadingDiv.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        // NEW FUNCTION: Render year-wise overview chart\r\n        function renderYearOverviewChart(data) {\r\n            if (yearOverviewChart) {\r\n                yearOverviewChart.destroy();\r\n            }\r\n            \r\n            const ctx = document.getElementById('yearOverviewChart');\r\n            \r\n            yearOverviewChart = new Chart(ctx, {\r\n                type: 'bar',\r\n                data: {\r\n                    labels: data.years,\r\n                    datasets: [\r\n                        {\r\n                            label: 'Open',\r\n                            data: data.open,\r\n                            backgroundColor: '#dc3545',\r\n                            borderRadius: 6,\r\n                            barThickness: 40\r\n                        },\r\n                        {\r\n                            label: 'Pending',\r\n                            data: data.pending,\r\n                            backgroundColor: '#ffc107',\r\n                            borderRadius: 6,\r\n                            barThickness: 40\r\n                        },\r\n                        {\r\n                            label: 'Resolved',\r\n                            data: data.resolved,\r\n                            backgroundColor: '#28a745',\r\n                            borderRadius: 6,\r\n                            barThickness: 40\r\n                        }\r\n                    ]\r\n                },\r\n                options: {\r\n                    responsive: true,\r\n                    maintainAspectRatio: false,\r\n                    plugins: {\r\n                        legend: {\r\n                            position: 'top',\r\n                            labels: {\r\n                                padding: 20,\r\n                                font: { size: 13, weight: '500' },\r\n                                usePointStyle: true,\r\n                                pointStyle: 'rect'\r\n                            }\r\n                        },\r\n                        tooltip: {\r\n                            callbacks: {\r\n                                label: function(context) {\r\n                                    return context.dataset.label + ': ' + context.parsed.y + ' tickets';\r\n                                }\r\n                            }\r\n                        }\r\n                    },\r\n                    scales: {\r\n                        x: {\r\n                            stacked: false,\r\n                            grid: { display: false },\r\n                            ticks: { font: { size: 12, weight: '500' } }\r\n                        },\r\n                        y: {\r\n                            stacked: false,\r\n                            beginAtZero: true,\r\n                            grid: { color: '#e9ecef' },\r\n                            ticks: { \r\n                                font: { size: 12 },\r\n                                stepSize: 100\r\n                            }\r\n                        }\r\n                    },\r\n                    onClick: (event, elements) => {\r\n                        if (elements.length > 0) {\r\n                            const datasetIndex = elements[0].datasetIndex;\r\n                            const index = elements[0].index;\r\n                            const year = data.years[index];\r\n                            const status = ['Open', 'Pending', 'Resolved'][datasetIndex];\r\n                            \r\n                            // Navigate with year and status filter\r\n                            navigateToYearStatus(year, status);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // NEW FUNCTION: Navigate with year and status filter\r\n        function navigateToYearStatus(year, status) {\r\n            const startDate = `${year}-01-01`;\r\n            const endDate = `${year}-12-31`;\r\n            \r\n            let filters = [\r\n                ['Ticket Master', 'creation', 'Between', [startDate + ' 00:00:00', endDate + ' 23:59:59']]\r\n            ];\r\n            \r\n            // Map status to actual workflow state\r\n            if (status === 'Resolved') {\r\n                filters.push(['Ticket Master', 'workflow_state', '=', 'Resolved']);\r\n            } else if (status === 'Pending') {\r\n                filters.push(['Ticket Master', 'workflow_state', '!=', 'Resolved']);\r\n                filters.push(['Ticket Master', 'workflow_state', '!=', 'Open']);\r\n            } else if (status === 'Open') {\r\n                filters.push(['Ticket Master', 'workflow_state', '=', 'Open']);\r\n            }\r\n            \r\n            applyFiltersAndNavigate(filters);\r\n        }\r\n\r\n        async function loadFilterOptions() {\r\n            const fromDate = document.getElementById('fromDate').value;\r\n            const toDate = document.getElementById('toDate').value;\r\n            \r\n            if (!fromDate || !toDate) {\r\n                return;\r\n            }\r\n            \r\n            try {\r\n                const [states, hospitals, robots, statuses, priorities, issueTypes] = await Promise.all([\r\n                    fetchFilterOptions('state', fromDate, toDate),\r\n                    fetchFilterOptions('hospital', fromDate, toDate),\r\n                    fetchFilterOptions('robot', fromDate, toDate),\r\n                    fetchFilterOptions('status', fromDate, toDate),\r\n                    fetchFilterOptions('priority', fromDate, toDate),\r\n                    fetchFilterOptions('issue_type', fromDate, toDate)\r\n                ]);\r\n                \r\n                populateSelect('stateFilter', states);\r\n                populateSelect('hospitalFilter', hospitals);\r\n                populateSelect('robotFilter', robots);\r\n                populateSelect('statusFilter', statuses);\r\n                populateSelect('priorityFilter', priorities);\r\n                populateSelect('issueTypeFilter', issueTypes);\r\n            } catch (error) {\r\n                console.error('Error loading filter options:', error);\r\n                showError('Failed to load filter options: ' + error.message);\r\n            }\r\n        }\r\n\r\n        async function fetchFilterOptions(filterType, fromDate, toDate) {\r\n            try {\r\n                const response = await fetch('/api/method/merai_newage.merai_newage.utils.dashboard_api.get_filter_options', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'X-Frappe-CSRF-Token': frappe.csrf_token\r\n                    },\r\n                    body: JSON.stringify({\r\n                        filter_type: filterType,\r\n                        from_date: fromDate,\r\n                        to_date: toDate\r\n                    })\r\n                });\r\n                \r\n                const result = await response.json();\r\n                \r\n                if (!response.ok) {\r\n                    console.error(`Error fetching ${filterType} options:`, result);\r\n                    return [];\r\n                }\r\n                \r\n                return result.message || [];\r\n            } catch (error) {\r\n                console.error(`Error fetching ${filterType} options:`, error);\r\n                return [];\r\n            }\r\n        }\r\n\r\n        function populateSelect(selectId, options) {\r\n            const select = document.getElementById(selectId);\r\n            const currentValue = select.value;\r\n            \r\n            const firstOption = select.options[0];\r\n            select.innerHTML = '';\r\n            select.appendChild(firstOption);\r\n            \r\n            options.forEach(option => {\r\n                const opt = document.createElement('option');\r\n                opt.value = option;\r\n                opt.textContent = option;\r\n                select.appendChild(opt);\r\n            });\r\n            \r\n            if (currentValue && options.includes(currentValue)) {\r\n                select.value = currentValue;\r\n            }\r\n        }\r\n\r\n        async function loadDashboardData() {\r\n            showLoading(true);\r\n            hideError();\r\n            \r\n            try {\r\n                const filters = getFilters();\r\n                \r\n                console.log('Loading dashboard with filters:', filters);\r\n                \r\n                const response = await fetch('/api/method/merai_newage.merai_newage.utils.dashboard_api.get_dashboard_data', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'X-Frappe-CSRF-Token': frappe.csrf_token\r\n                    },\r\n                    body: JSON.stringify({ filters: filters })\r\n                });\r\n                \r\n                if (!response.ok) {\r\n                    throw new Error(`HTTP error! status: ${response.status}`);\r\n                }\r\n                \r\n                const result = await response.json();\r\n                console.log('Dashboard data received:', result);\r\n                \r\n                if (result.message) {\r\n                    dashboardData = result.message;\r\n                    renderDashboard();\r\n                } else {\r\n                    throw new Error('No data received from server');\r\n                }\r\n            } catch (error) {\r\n                console.error('Error loading dashboard data:', error);\r\n                showError('Failed to load dashboard data: ' + error.message + '. Please check your connection and try again.');\r\n            } finally {\r\n                showLoading(false);\r\n            }\r\n        }\r\n\r\n        function getFilters() {\r\n            return {\r\n                from_date: document.getElementById('fromDate').value || null,\r\n                to_date: document.getElementById('toDate').value || null,\r\n                state: document.getElementById('stateFilter').value || null,\r\n                hospital_name: document.getElementById('hospitalFilter').value || null,\r\n                robot_serial_no: document.getElementById('robotFilter').value || null,\r\n                status: document.getElementById('statusFilter').value || null,\r\n                priorty: document.getElementById('priorityFilter').value || null,\r\n                issue_type: document.getElementById('issueTypeFilter').value || null\r\n            };\r\n        }\r\n\r\n        function renderDashboard() {\r\n            const initialMsg = document.getElementById('initialMessage');\r\n            if (initialMsg) {\r\n                initialMsg.style.display = 'none';\r\n            }\r\n            \r\n            updateMetrics();\r\n            renderCharts();\r\n            populateTable();\r\n            updateTimestamp();\r\n            document.getElementById('dashboardContent').style.display = 'block';\r\n        }\r\n\r\n        function updateMetrics() {\r\n            const metrics = dashboardData.metrics;\r\n            \r\n            document.getElementById('totalTickets').textContent = metrics.total;\r\n            document.getElementById('resolvedTickets').textContent = metrics.resolved;\r\n            document.getElementById('pendingTickets').textContent = metrics.pending;\r\n            document.getElementById('cancelledTickets').textContent = metrics.cancelled;\r\n            document.getElementById('avgTime').textContent = metrics.avg_resolution_time + ' days';\r\n            \r\n            document.getElementById('weekCount').textContent = `+${metrics.week_count} this week`;\r\n            document.getElementById('resolvedPercent').textContent = `${metrics.resolved_percentage}% of total`;\r\n            document.getElementById('pendingPercent').textContent = `${metrics.pending_percentage}% of total`;\r\n            document.getElementById('cancelledPercent').textContent = `${metrics.cancelled_percentage}% of total`;\r\n        }\r\n\r\n        function getPaginatedData(labels, data, page, itemsPerPage) {\r\n            const startIndex = page * itemsPerPage;\r\n            const endIndex = startIndex + itemsPerPage;\r\n            return {\r\n                labels: labels.slice(startIndex, endIndex),\r\n                data: data.slice(startIndex, endIndex)\r\n            };\r\n        }\r\n\r\n        function updatePaginationControls(chartType, currentPage, totalPages) {\r\n            const paginationDiv = document.getElementById(`${chartType}Pagination`);\r\n            const pageInfo = document.getElementById(`${chartType}PageInfo`);\r\n            const prevBtn = document.getElementById(`${chartType}PrevBtn`);\r\n            const nextBtn = document.getElementById(`${chartType}NextBtn`);\r\n            const pageInput = document.getElementById(`${chartType}PageInput`);\r\n            \r\n            if (totalPages > 1) {\r\n                paginationDiv.style.display = 'flex';\r\n                pageInfo.textContent = `Page ${currentPage + 1} of ${totalPages}`;\r\n                prevBtn.disabled = currentPage === 0;\r\n                nextBtn.disabled = currentPage === totalPages - 1;\r\n                \r\n                if (pageInput) {\r\n                    pageInput.value = currentPage + 1;\r\n                    pageInput.max = totalPages;\r\n                }\r\n            } else {\r\n                paginationDiv.style.display = 'none';\r\n            }\r\n        }\r\n\r\n        function changeTimelinePage(direction) {\r\n            const totalPages = Math.ceil(fullData.timeline.labels.length / ITEMS_PER_PAGE);\r\n            currentPages.timeline = Math.max(0, Math.min(currentPages.timeline + direction, totalPages - 1));\r\n            renderTimelineChart();\r\n        }\r\n\r\n        function jumpToTimelinePage() {\r\n            const input = document.getElementById('timelinePageInput');\r\n            const page = parseInt(input.value) - 1;\r\n            const totalPages = Math.ceil(fullData.timeline.labels.length / ITEMS_PER_PAGE);\r\n            \r\n            if (page >= 0 && page < totalPages) {\r\n                currentPages.timeline = page;\r\n                renderTimelineChart();\r\n            } else {\r\n                input.value = currentPages.timeline + 1;\r\n            }\r\n        }\r\n\r\n        function changeHospitalPage(direction) {\r\n            const totalPages = Math.ceil(fullData.hospital.labels.length / ITEMS_PER_PAGE);\r\n            currentPages.hospital = Math.max(0, Math.min(currentPages.hospital + direction, totalPages - 1));\r\n            renderHospitalChart();\r\n        }\r\n\r\n        function jumpToHospitalPage() {\r\n            const input = document.getElementById('hospitalPageInput');\r\n            const page = parseInt(input.value) - 1;\r\n            const totalPages = Math.ceil(fullData.hospital.labels.length / ITEMS_PER_PAGE);\r\n            \r\n            if (page >= 0 && page < totalPages) {\r\n                currentPages.hospital = page;\r\n                renderHospitalChart();\r\n            } else {\r\n                input.value = currentPages.hospital + 1;\r\n            }\r\n        }\r\n\r\n        function changeStatePage(direction) {\r\n            const totalPages = Math.ceil(fullData.state.labels.length / ITEMS_PER_PAGE);\r\n            currentPages.state = Math.max(0, Math.min(currentPages.state + direction, totalPages - 1));\r\n            renderStateChart();\r\n        }\r\n\r\n        function jumpToStatePage() {\r\n            const input = document.getElementById('statePageInput');\r\n            const page = parseInt(input.value) - 1;\r\n            const totalPages = Math.ceil(fullData.state.labels.length / ITEMS_PER_PAGE);\r\n            \r\n            if (page >= 0 && page < totalPages) {\r\n                currentPages.state = page;\r\n                renderStateChart();\r\n            } else {\r\n                input.value = currentPages.state + 1;\r\n            }\r\n        }\r\n\r\n        function changeRobotPage(direction) {\r\n            const totalPages = Math.ceil(fullData.robot.labels.length / ITEMS_PER_PAGE);\r\n            currentPages.robot = Math.max(0, Math.min(currentPages.robot + direction, totalPages - 1));\r\n            renderRobotChart();\r\n        }\r\n\r\n        function jumpToRobotPage() {\r\n            const input = document.getElementById('robotPageInput');\r\n            const page = parseInt(input.value) - 1;\r\n            const totalPages = Math.ceil(fullData.robot.labels.length / ITEMS_PER_PAGE);\r\n            \r\n            if (page >= 0 && page < totalPages) {\r\n                currentPages.robot = page;\r\n                renderRobotChart();\r\n            } else {\r\n                input.value = currentPages.robot + 1;\r\n            }\r\n        }\r\n        \r\n        function renderCharts() {\r\n            Object.values(charts).forEach(chart => {\r\n                if (chart && typeof chart.destroy === 'function') {\r\n                    chart.destroy();\r\n                }\r\n            });\r\n            charts = {};\r\n            \r\n            currentPages = { timeline: 0, hospital: 0, state: 0, robot: 0 };\r\n            \r\n            if (dashboardData.timeline_data) {\r\n                fullData.timeline = {\r\n                    labels: [...(dashboardData.timeline_data.labels || [])],\r\n                    data: [...(dashboardData.timeline_data.data || [])]\r\n                };\r\n            }\r\n            if (dashboardData.hospital_data) {\r\n                fullData.hospital = {\r\n                    labels: [...(dashboardData.hospital_data.labels || [])],\r\n                    data: [...(dashboardData.hospital_data.data || [])]\r\n                };\r\n            }\r\n            if (dashboardData.state_distribution) {\r\n                fullData.state = {\r\n                    labels: [...(dashboardData.state_distribution.labels || [])],\r\n                    data: [...(dashboardData.state_distribution.data || [])]\r\n                };\r\n            }\r\n            if (dashboardData.robot_data) {\r\n                fullData.robot = {\r\n                    labels: [...(dashboardData.robot_data.labels || [])],\r\n                    data: [...(dashboardData.robot_data.data || [])]\r\n                };\r\n            }\r\n            \r\n            renderStatusChart();\r\n            renderIssueTypeChart();\r\n            renderTimelineChart();\r\n            renderHospitalChart();\r\n            renderStateChart();\r\n            renderPriorityChart();\r\n            renderRobotChart();\r\n        }\r\n\r\n        function renderStatusChart() {\r\n            if (dashboardData.status_distribution && dashboardData.status_distribution.labels.length > 0) {\r\n                charts.status = new Chart(document.getElementById('statusChart'), {\r\n                    type: 'doughnut',\r\n                    data: {\r\n                        labels: dashboardData.status_distribution.labels,\r\n                        datasets: [{\r\n                            data: dashboardData.status_distribution.data,\r\n                            backgroundColor: ['#28a745', '#ffc107', '#dc3545', '#6c757d', '#17a2b8'],\r\n                            borderWidth: 2,\r\n                            borderColor: '#fff'\r\n                        }]\r\n                    },\r\n                    options: {\r\n                        responsive: true,\r\n                        maintainAspectRatio: false,\r\n                        plugins: {\r\n                            legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } }\r\n                        },\r\n                        onClick: (event, elements) => {\r\n                            if (elements.length > 0) {\r\n                                const index = elements[0].index;\r\n                                const status = dashboardData.status_distribution.labels[index];\r\n                                navigateToDoctypeWithFilters({ workflow_state: status });\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        function renderIssueTypeChart() {\r\n            if (dashboardData.issue_type_distribution && dashboardData.issue_type_distribution.labels.length > 0) {\r\n                charts.issueType = new Chart(document.getElementById('issueTypeChart'), {\r\n                    type: 'pie',\r\n                    data: {\r\n                        labels: dashboardData.issue_type_distribution.labels,\r\n                        datasets: [{\r\n                            data: dashboardData.issue_type_distribution.data,\r\n                            backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#00f2fe'],\r\n                            borderWidth: 2,\r\n                            borderColor: '#fff'\r\n                        }]\r\n                    },\r\n                    options: {\r\n                        responsive: true,\r\n                        maintainAspectRatio: false,\r\n                        plugins: {\r\n                            legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } }\r\n                        },\r\n                        onClick: (event, elements) => {\r\n                            if (elements.length > 0) {\r\n                                const index = elements[0].index;\r\n                                const issueType = dashboardData.issue_type_distribution.labels[index];\r\n                                navigateToDoctypeWithFilters({ issue_type: issueType });\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        function renderTimelineChart() {\r\n            if (fullData.timeline.labels.length > 0) {\r\n                const totalPages = Math.ceil(fullData.timeline.labels.length / ITEMS_PER_PAGE);\r\n                const paginatedData = getPaginatedData(\r\n                    fullData.timeline.labels,\r\n                    fullData.timeline.data,\r\n                    currentPages.timeline,\r\n                    ITEMS_PER_PAGE\r\n                );\r\n                \r\n                if (charts.timeline) charts.timeline.destroy();\r\n                \r\n                charts.timeline = new Chart(document.getElementById('timelineChart'), {\r\n                    type: 'line',\r\n                    data: {\r\n                        labels: paginatedData.labels,\r\n                        datasets: [{\r\n                            label: 'Tickets Created',\r\n                            data: paginatedData.data,\r\n                            borderColor: '#667eea',\r\n                            backgroundColor: 'rgba(102, 126, 234, 0.1)',\r\n                            tension: 0.4,\r\n                            fill: true\r\n                        }]\r\n                    },\r\n                    options: {\r\n                        responsive: true,\r\n                        maintainAspectRatio: false,\r\n                        plugins: {\r\n                            legend: { display: false }\r\n                        },\r\n                        scales: {\r\n                            y: { beginAtZero: true }\r\n                        },\r\n                        onClick: (event, elements) => {\r\n                            if (elements.length > 0) {\r\n                                const index = elements[0].index;\r\n                                const date = paginatedData.labels[index];\r\n                                navigateToDoctypeWithFilters({ creation: date });\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                \r\n                updatePaginationControls('timeline', currentPages.timeline, totalPages);\r\n            }\r\n        }\r\n\r\n        function renderHospitalChart() {\r\n            if (fullData.hospital.labels.length > 0) {\r\n                const dataLength = fullData.hospital.labels.length;\r\n                const useScroll = dataLength > SCROLL_THRESHOLD;\r\n                \r\n                if (useScroll) {\r\n                    renderHospitalChartWithScroll();\r\n                } else {\r\n                    renderHospitalChartWithPagination();\r\n                }\r\n            }\r\n        }\r\n\r\n        function renderHospitalChartWithScroll() {\r\n            if (charts.hospital) charts.hospital.destroy();\r\n            \r\n            const hospitalCanvas = document.getElementById('hospitalChart');\r\n            const itemHeight = 30;\r\n            const calculatedHeight = Math.max(300, fullData.hospital.labels.length * itemHeight);\r\n            hospitalCanvas.height = calculatedHeight;\r\n            \r\n            charts.hospital = new Chart(hospitalCanvas, {\r\n                type: 'bar',\r\n                data: {\r\n                    labels: fullData.hospital.labels,\r\n                    datasets: [{\r\n                        label: 'Number of Tickets',\r\n                        data: fullData.hospital.data,\r\n                        backgroundColor: '#667eea',\r\n                        borderRadius: 8\r\n                    }]\r\n                },\r\n                options: {\r\n                    responsive: true,\r\n                    maintainAspectRatio: false,\r\n                    indexAxis: 'y',\r\n                    plugins: {\r\n                        legend: { display: false }\r\n                    },\r\n                    scales: {\r\n                        x: { beginAtZero: true }\r\n                    },\r\n                    onClick: (event, elements) => {\r\n                        if (elements.length > 0) {\r\n                            const index = elements[0].index;\r\n                            const hospital = fullData.hospital.labels[index];\r\n                            navigateToDoctypeWithFilters({ hospital_name: hospital });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            \r\n            document.getElementById('hospitalPagination').style.display = 'none';\r\n        }\r\n\r\n        function renderHospitalChartWithPagination() {\r\n            const totalPages = Math.ceil(fullData.hospital.labels.length / ITEMS_PER_PAGE);\r\n            const paginatedData = getPaginatedData(\r\n                fullData.hospital.labels,\r\n                fullData.hospital.data,\r\n                currentPages.hospital,\r\n                ITEMS_PER_PAGE\r\n            );\r\n            \r\n            if (charts.hospital) charts.hospital.destroy();\r\n            \r\n            const hospitalCanvas = document.getElementById('hospitalChart');\r\n            hospitalCanvas.height = 300;\r\n            \r\n            charts.hospital = new Chart(hospitalCanvas, {\r\n                type: 'bar',\r\n                data: {\r\n                    labels: paginatedData.labels,\r\n                    datasets: [{\r\n                        label: 'Number of Tickets',\r\n                        data: paginatedData.data,\r\n                        backgroundColor: '#667eea',\r\n                        borderRadius: 8\r\n                    }]\r\n                },\r\n                options: {\r\n                    responsive: true,\r\n                    maintainAspectRatio: false,\r\n                    indexAxis: 'y',\r\n                    plugins: {\r\n                        legend: { display: false }\r\n                    },\r\n                    scales: {\r\n                        x: { beginAtZero: true }\r\n                    },\r\n                    onClick: (event, elements) => {\r\n                        if (elements.length > 0) {\r\n                            const index = elements[0].index;\r\n                            const hospital = paginatedData.labels[index];\r\n                            navigateToDoctypeWithFilters({ hospital_name: hospital });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            \r\n            updatePaginationControls('hospital', currentPages.hospital, totalPages);\r\n        }\r\n\r\n        function renderStateChart() {\r\n            if (fullData.state.labels.length > 0) {\r\n                const dataLength = fullData.state.labels.length;\r\n                const useScroll = dataLength > SCROLL_THRESHOLD;\r\n                \r\n                if (useScroll) {\r\n                    renderStateChartWithScroll();\r\n                } else {\r\n                    renderStateChartWithPagination();\r\n                }\r\n            }\r\n        }\r\n\r\n        function renderStateChartWithScroll() {\r\n            if (charts.state) charts.state.destroy();\r\n            \r\n            const stateCanvas = document.getElementById('stateChart');\r\n            const itemHeight = 30;\r\n            const calculatedHeight = Math.max(300, fullData.state.labels.length * itemHeight);\r\n            stateCanvas.height = calculatedHeight;\r\n            \r\n            charts.state = new Chart(stateCanvas, {\r\n                type: 'bar',\r\n                data: {\r\n                    labels: fullData.state.labels,\r\n                    datasets: [{\r\n                        label: 'Tickets by State',\r\n                        data: fullData.state.data,\r\n                        backgroundColor: '#764ba2',\r\n                        borderRadius: 8\r\n                    }]\r\n                },\r\n                options: {\r\n                    responsive: true,\r\n                    maintainAspectRatio: false,\r\n                    indexAxis: 'y',\r\n                    plugins: {\r\n                        legend: { display: false }\r\n                    },\r\n                    scales: {\r\n                        x: { beginAtZero: true }\r\n                    },\r\n                    onClick: (event, elements) => {\r\n                        if (elements.length > 0) {\r\n                            const index = elements[0].index;\r\n                            const state = fullData.state.labels[index];\r\n                            navigateToDoctypeWithFilters({ state: state });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            \r\n            document.getElementById('statePagination').style.display = 'none';\r\n        }\r\n\r\n        function renderStateChartWithPagination() {\r\n            const totalPages = Math.ceil(fullData.state.labels.length / ITEMS_PER_PAGE);\r\n            const paginatedData = getPaginatedData(\r\n                fullData.state.labels,\r\n                fullData.state.data,\r\n                currentPages.state,\r\n                ITEMS_PER_PAGE\r\n            );\r\n            \r\n            if (charts.state) charts.state.destroy();\r\n            \r\n            const stateCanvas = document.getElementById('stateChart');\r\n            stateCanvas.height = 300;\r\n            \r\n            charts.state = new Chart(stateCanvas, {\r\n                type: 'bar',\r\n                data: {\r\n                    labels: paginatedData.labels,\r\n                    datasets: [{\r\n                        label: 'Tickets by State',\r\n                        data: paginatedData.data,\r\n                        backgroundColor: '#764ba2',\r\n                        borderRadius: 8\r\n                    }]\r\n                },\r\n                options: {\r\n                    responsive: true,\r\n                    maintainAspectRatio: false,\r\n                    indexAxis: 'y',\r\n                    plugins: {\r\n                        legend: { display: false }\r\n                    },\r\n                    scales: {\r\n                        x: { beginAtZero: true }\r\n                    },\r\n                    onClick: (event, elements) => {\r\n                        if (elements.length > 0) {\r\n                            const index = elements[0].index;\r\n                            const state = paginatedData.labels[index];\r\n                            navigateToDoctypeWithFilters({ state: state });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            \r\n            updatePaginationControls('state', currentPages.state, totalPages);\r\n        }\r\n\r\n        function renderPriorityChart() {\r\n            if (dashboardData.priority_distribution && dashboardData.priority_distribution.labels.length > 0) {\r\n                charts.priority = new Chart(document.getElementById('priorityChart'), {\r\n                    type: 'doughnut',\r\n                    data: {\r\n                        labels: dashboardData.priority_distribution.labels,\r\n                        datasets: [{\r\n                            data: dashboardData.priority_distribution.data,\r\n                            backgroundColor: ['#dc3545', '#ffc107', '#28a745'],\r\n                            borderWidth: 2,\r\n                            borderColor: '#fff'\r\n                        }]\r\n                    },\r\n                    options: {\r\n                        responsive: true,\r\n                        maintainAspectRatio: false,\r\n                        plugins: {\r\n                            legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } }\r\n                        },\r\n                        onClick: (event, elements) => {\r\n                            if (elements.length > 0) {\r\n                                const index = elements[0].index;\r\n                                const priority = dashboardData.priority_distribution.labels[index];\r\n                                navigateToDoctypeWithFilters({ priorty: priority });\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        function renderRobotChart() {\r\n            if (fullData.robot.labels.length > 0) {\r\n                const dataLength = fullData.robot.labels.length;\r\n                const useScroll = dataLength > SCROLL_THRESHOLD;\r\n                \r\n                if (useScroll) {\r\n                    renderRobotChartWithScroll();\r\n                } else {\r\n                    renderRobotChartWithPagination();\r\n                }\r\n            }\r\n        }\r\n\r\n        function renderRobotChartWithScroll() {\r\n            if (charts.robot) charts.robot.destroy();\r\n            \r\n            const robotCanvas = document.getElementById('robotChart');\r\n            const itemHeight = 30;\r\n            const calculatedHeight = Math.max(300, fullData.robot.labels.length * itemHeight);\r\n            robotCanvas.height = calculatedHeight;\r\n            \r\n            charts.robot = new Chart(robotCanvas, {\r\n                type: 'bar',\r\n                data: {\r\n                    labels: fullData.robot.labels,\r\n                    datasets: [{\r\n                        label: 'Issue Count',\r\n                        data: fullData.robot.data,\r\n                        backgroundColor: '#4facfe',\r\n                        borderRadius: 8\r\n                    }]\r\n                },\r\n                options: {\r\n                    responsive: true,\r\n                    maintainAspectRatio: false,\r\n                    indexAxis: 'y',\r\n                    plugins: {\r\n                        legend: { display: false }\r\n                    },\r\n                    scales: {\r\n                        x: { beginAtZero: true }\r\n                    },\r\n                    onClick: (event, elements) => {\r\n                        if (elements.length > 0) {\r\n                            const index = elements[0].index;\r\n                            const robot = fullData.robot.labels[index];\r\n                            navigateToDoctypeWithFilters({ robot_serial_no: robot });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            \r\n            document.getElementById('robotPagination').style.display = 'none';\r\n        }\r\n\r\n        function renderRobotChartWithPagination() {\r\n            const totalPages = Math.ceil(fullData.robot.labels.length / ITEMS_PER_PAGE);\r\n            const paginatedData = getPaginatedData(\r\n                fullData.robot.labels,\r\n                fullData.robot.data,\r\n                currentPages.robot,\r\n                ITEMS_PER_PAGE\r\n            );\r\n            \r\n            if (charts.robot) charts.robot.destroy();\r\n            \r\n            const robotCanvas = document.getElementById('robotChart');\r\n            robotCanvas.height = 300;\r\n            \r\n            charts.robot = new Chart(robotCanvas, {\r\n                type: 'bar',\r\n                data: {\r\n                    labels: paginatedData.labels,\r\n                    datasets: [{\r\n                        label: 'Issue Count',\r\n                        data: paginatedData.data,\r\n                        backgroundColor: '#4facfe',\r\n                        borderRadius: 8\r\n                    }]\r\n                },\r\n                options: {\r\n                    responsive: true,\r\n                    maintainAspectRatio: false,\r\n                    indexAxis: 'y',\r\n                    plugins: {\r\n                        legend: { display: false }\r\n                    },\r\n                    scales: {\r\n                        x: { beginAtZero: true }\r\n                    },\r\n                    onClick: (event, elements) => {\r\n                        if (elements.length > 0) {\r\n                            const index = elements[0].index;\r\n                            const robot = paginatedData.labels[index];\r\n                            navigateToDoctypeWithFilters({ robot_serial_no: robot });\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            \r\n            updatePaginationControls('robot', currentPages.robot, totalPages);\r\n        }\r\n\r\n        function populateTable() {\r\n            const tbody = document.getElementById('ticketTable');\r\n            const tickets = dashboardData.recent_tickets;\r\n            \r\n            if (!tickets || tickets.length === 0) {\r\n                tbody.innerHTML = '<tr><td colspan=\"11\" style=\"text-align: center; padding: 30px;\">No tickets found for the selected filters</td></tr>';\r\n                return;\r\n            }\r\n            \r\n            tbody.innerHTML = tickets.map(ticket => {\r\n                const statusClass = getStatusClass(ticket.workflow_state);\r\n                const ticketUrl = `/app/ticket-master/${ticket.name}`;\r\n                \r\n                return `\r\n                    <tr>\r\n                        <td><a href=\"${ticketUrl}\" class=\"ticket-link\">${ticket.name}</a></td>\r\n                        <td><span class=\"status-badge ${statusClass}\">${ticket.workflow_state || 'N/A'}</span></td>\r\n                        <td>${ticket.state || '-'}</td>\r\n                        <td>${ticket.robot_serial_no || '-'}</td>\r\n                        <td>${ticket.ticket_subject || '-'}</td>\r\n                        <td>${ticket.hospital_name || '-'}</td>\r\n                        <td>${ticket.issue_type || '-'}</td>\r\n                        <td>${ticket.priorty || '-'}</td>\r\n                        <td>${ticket.engineers || '-'}</td>\r\n                        <td>${ticket.days_open}d</td>\r\n                        <td>${formatDate(ticket.creation)}</td>\r\n                    </tr>\r\n                `;\r\n            }).join('');\r\n        }\r\n\r\n        function getStatusClass(status) {\r\n            if (!status) return 'status-open';\r\n            const statusLower = status.toLowerCase();\r\n            if (statusLower.includes('resolved')) return 'status-resolved';\r\n            if (statusLower.includes('pending')) return 'status-pending';\r\n            if (statusLower.includes('closed')) return 'status-closed';\r\n            return 'status-open';\r\n        }\r\n\r\n        function formatDate(dateStr) {\r\n            if (!dateStr) return '-';\r\n            const date = new Date(dateStr);\r\n            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});\r\n        }\r\n\r\n        function updateTimestamp() {\r\n            document.getElementById('lastUpdate').textContent = new Date().toLocaleString();\r\n        }\r\n\r\n        function applyFilters() {\r\n            const fromDate = document.getElementById('fromDate').value;\r\n            const toDate = document.getElementById('toDate').value;\r\n            \r\n            if (!fromDate || !toDate) {\r\n                showError('Please select both From Date and To Date before applying filters.');\r\n                return;\r\n            }\r\n            \r\n            loadFilterOptions().then(() => {\r\n                loadDashboardData();\r\n                setTimeout(() => {\r\n                    const filterSection = document.getElementById('filterSection');\r\n                    if (filterSection && !filterSection.classList.contains('collapsed')) {\r\n                        filterSection.classList.add('collapsed');\r\n                    }\r\n                }, 500);\r\n            });\r\n        }\r\n\r\n        function clearFilters() {\r\n            document.getElementById('fromDate').value = '';\r\n            document.getElementById('toDate').value = '';\r\n            document.getElementById('stateFilter').value = '';\r\n            document.getElementById('hospitalFilter').value = '';\r\n            document.getElementById('robotFilter').value = '';\r\n            document.getElementById('statusFilter').value = '';\r\n            document.getElementById('priorityFilter').value = '';\r\n            document.getElementById('issueTypeFilter').value = '';\r\n            \r\n            const selects = ['stateFilter', 'hospitalFilter', 'robotFilter', 'statusFilter', 'priorityFilter', 'issueTypeFilter'];\r\n            selects.forEach(id => {\r\n                const select = document.getElementById(id);\r\n                while (select.options.length > 1) {\r\n                    select.remove(1);\r\n                }\r\n            });\r\n            \r\n            document.getElementById('dashboardContent').style.display = 'none';\r\n            const initialMsg = document.getElementById('initialMessage');\r\n            if (initialMsg) {\r\n                initialMsg.style.display = 'block';\r\n            }\r\n            \r\n            const filterSection = document.getElementById('filterSection');\r\n            if (filterSection && filterSection.classList.contains('collapsed')) {\r\n                filterSection.classList.remove('collapsed');\r\n            }\r\n            \r\n            hideError();\r\n        }\r\n\r\n        function refreshData() {\r\n            const fromDate = document.getElementById('fromDate').value;\r\n            const toDate = document.getElementById('toDate').value;\r\n            \r\n            if (!fromDate || !toDate) {\r\n                showError('Please select both From Date and To Date before refreshing.');\r\n                return;\r\n            }\r\n            \r\n            loadDashboardData();\r\n            loadYearOverviewData(); // Also refresh year overview\r\n        }\r\n\r\n        function exportToCSV() {\r\n            if (!dashboardData || !dashboardData.recent_tickets) {\r\n                showError('No data available to export');\r\n                return;\r\n            }\r\n            \r\n            const tickets = dashboardData.recent_tickets;\r\n            const headers = ['Ticket ID', 'Status', 'State', 'Robot Serial No', 'Subject', 'Hospital', 'Issue Type', 'Priority', 'Engineers', 'Created On'];\r\n            \r\n            const csvContent = [\r\n                headers.join(','),\r\n                ...tickets.map(t => [\r\n                    t.name,\r\n                    t.workflow_state || '',\r\n                    t.state || '',\r\n                    t.robot_serial_no || '',\r\n                    `\"${(t.ticket_subject || '').replace(/\"/g, '\"\"')}\"`,\r\n                    t.hospital_name || '',\r\n                    t.issue_type || '',\r\n                    t.priorty || '',\r\n                    `\"${(t.engineers || '').replace(/\"/g, '\"\"')}\"`,\r\n\r\n                    t.creation || ''\r\n                ].join(','))\r\n            ].join('\\n');\r\n\r\n            const blob = new Blob([csvContent], { type: 'text/csv' });\r\n            const url = window.URL.createObjectURL(blob);\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.download = `ticket_master_export_${new Date().toISOString().split('T')[0]}.csv`;\r\n            a.click();\r\n            window.URL.revokeObjectURL(url);\r\n        }\r\n\r\n        function showLoading(show) {\r\n            document.getElementById('loadingIndicator').style.display = show ? 'block' : 'none';\r\n        }\r\n\r\n        function showError(message) {\r\n            const errorContainer = document.getElementById('errorContainer');\r\n            errorContainer.innerHTML = `<div class=\"error-message\">${message}</div>`;\r\n        }\r\n\r\n        function hideError() {\r\n            document.getElementById('errorContainer').innerHTML = '';\r\n        }\r\n\r\n        // FIXED FUNCTION: Clear all previous filters and apply only new ones\r\n        function navigateToDoctypeWithFilters(additionalFilters = {}) {\r\n            console.log('=== NAVIGATION WITH FILTERS STARTED ===');\r\n            console.log('Additional filters passed:', additionalFilters);\r\n            \r\n            const fromDate = document.getElementById('fromDate').value;\r\n            const toDate = document.getElementById('toDate').value;\r\n            const state = document.getElementById('stateFilter').value;\r\n            const hospital = document.getElementById('hospitalFilter').value;\r\n            const robot = document.getElementById('robotFilter').value;\r\n            const status = document.getElementById('statusFilter').value;\r\n            const priority = document.getElementById('priorityFilter').value;\r\n            const issueType = document.getElementById('issueTypeFilter').value;\r\n            \r\n            // START FRESH - Build brand new filter array\r\n            let filters = [];\r\n            \r\n            // Add date range filter ONLY if dates are selected\r\n            if (fromDate && toDate) {\r\n                filters.push(['Ticket Master', 'creation', 'Between', [fromDate + ' 00:00:00', toDate + ' 23:59:59']]);\r\n            }\r\n            \r\n            // Add dashboard filters ONLY if they exist\r\n            if (state) {\r\n                filters.push(['Ticket Master', 'state', '=', state]);\r\n            }\r\n            if (hospital) {\r\n                filters.push(['Ticket Master', 'hospital_name', '=', hospital]);\r\n            }\r\n            if (robot) {\r\n                filters.push(['Ticket Master', 'robot_serial_no', '=', robot]);\r\n            }\r\n            if (status) {\r\n                filters.push(['Ticket Master', 'workflow_state', '=', status]);\r\n            }\r\n            if (priority) {\r\n                filters.push(['Ticket Master', 'priorty', '=', priority]);\r\n            }\r\n            if (issueType) {\r\n                filters.push(['Ticket Master', 'issue_type', '=', issueType]);\r\n            }\r\n            \r\n            // NOW add additional filters from card clicks (these override dashboard filters)\r\n            Object.entries(additionalFilters).forEach(([key, value]) => {\r\n                if (value) {\r\n                    if (key.endsWith('_not')) {\r\n                        const actualKey = key.replace('_not', '');\r\n                        // Remove any existing filter for this key\r\n                        filters = filters.filter(f => f[1] !== actualKey);\r\n                        // Add the NOT filter\r\n                        filters.push(['Ticket Master', actualKey, '!=', value]);\r\n                    } else {\r\n                        // Remove any existing filter for this key\r\n                        filters = filters.filter(f => f[1] !== key);\r\n                        // Add the new filter\r\n                        filters.push(['Ticket Master', key, '=', value]);\r\n                    }\r\n                }\r\n            });\r\n            \r\n            console.log('Final filters to apply:', JSON.stringify(filters, null, 2));\r\n            \r\n            // Apply filters using helper function\r\n            applyFiltersAndNavigate(filters);\r\n        }\r\n\r\n        // HELPER FUNCTION: Common filter application logic\r\n        function applyFiltersAndNavigate(filters) {\r\n            // Clear ALL old storage\r\n            try {\r\n                sessionStorage.clear();\r\n                localStorage.removeItem('pending_list_filters');\r\n                console.log('Cleared all old filter storage');\r\n            } catch (e) {\r\n                console.error('Failed to clear old filters:', e);\r\n            }\r\n            \r\n            // Store ONLY the new filters\r\n            try {\r\n                sessionStorage.setItem('pending_list_filters', JSON.stringify(filters));\r\n                console.log('Stored fresh filters in sessionStorage');\r\n            } catch (e) {\r\n                console.error('Failed to store filters:', e);\r\n            }\r\n            \r\n            // Open list view in new tab\r\n            const listWindow = window.open('/app/ticket-master', '_blank');\r\n            \r\n            // Send clear command followed by new filters\r\n            setTimeout(() => {\r\n                try {\r\n                    if (listWindow && !listWindow.closed) {\r\n                        // First: Clear everything\r\n                        listWindow.postMessage({\r\n                            type: 'clear_all_filters'\r\n                        }, window.location.origin);\r\n                        \r\n                        console.log('Sent clear command to new window');\r\n                        \r\n                        // Then: Apply ONLY new filters\r\n                        setTimeout(() => {\r\n                            listWindow.postMessage({\r\n                                type: 'apply_dashboard_filters',\r\n                                filters: filters,\r\n                                clearExisting: true\r\n                            }, window.location.origin);\r\n                            \r\n                            console.log('Sent fresh filters to new window');\r\n                        }, 200);\r\n                    }\r\n                } catch (e) {\r\n                    console.error('Could not send message to new window:', e);\r\n                }\r\n            }, 2000);\r\n        }\r\n\r\n        // Auto-refresh every 5 minutes\r\n        setInterval(() => {\r\n            const fromDate = document.getElementById('fromDate').value;\r\n            const toDate = document.getElementById('toDate').value;\r\n            \r\n            if (fromDate && toDate && document.getElementById('dashboardContent').style.display !== 'none') {\r\n                console.log('Auto-refreshing dashboard data...');\r\n                refreshData();\r\n            }\r\n        }, 300000);\r\n\r\n        // Listen for messages from list view\r\n        window.addEventListener('message', function(event) {\r\n            if (event.data && event.data.type === 'apply_filters') {\r\n                console.log('Received filter message:', event.data.filters);\r\n                if (typeof frappe !== 'undefined' && frappe.set_route) {\r\n                    frappe.set_route('List', 'Ticket Master', event.data.filters);\r\n                }\r\n            }\r\n        });\r\n    </script>\r\n</body>\r\n</html>",
  "main_section_md": null,
  "meta_description": null,
  "meta_image": null,
  "meta_title": null,
  "modified": "2026-01-30 11:38:05.296457",
  "module": "Merai Newage",
  "name": "ticket-mangement",
  "page_blocks": [],
  "published": 1,
  "route": "ticket-dashboard",
  "show_sidebar": 0,
  "show_title": 0,
  "slideshow": null,
  "start_date": null,
  "text_align": "Left",
  "title": "Ticket Mangement",
  "website_sidebar": null
 }
]